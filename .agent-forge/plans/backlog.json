{
  "project": "snow-asset-agent",
  "updated_at": "2026-02-12T22:00:00Z",
  "phases": [
    {
      "id": "phase-1",
      "name": "Foundation",
      "description": "Project structure, ServiceNow REST client, MCP server skeleton, configuration management, and base models",
      "milestone": "MCP server starts, connects to ServiceNow instance, and responds to health check",
      "status": "active",
      "tickets": ["ASSET-001", "ASSET-002", "ASSET-003", "ASSET-004", "ASSET-005", "ASSET-006"]
    },
    {
      "id": "phase-2",
      "name": "Core Asset Tools",
      "description": "Hardware asset queries, software license queries, asset detail retrieval, and lifecycle tracking MCP tools",
      "milestone": "All 5 core asset query/detail tools registered and returning real ServiceNow data",
      "status": "planned",
      "tickets": ["ASSET-007", "ASSET-008", "ASSET-009", "ASSET-010", "ASSET-011"]
    },
    {
      "id": "phase-3",
      "name": "Financial & Compliance",
      "description": "Cost analysis, license compliance checking, contract management, and depreciation tracking tools",
      "milestone": "All 4 financial/compliance tools operational with real ServiceNow asset and contract data",
      "status": "planned",
      "tickets": ["ASSET-012", "ASSET-013", "ASSET-014", "ASSET-015"]
    },
    {
      "id": "phase-4",
      "name": "Analytics & Reconciliation",
      "description": "Utilization analysis, asset-to-CI reconciliation, health metrics dashboard, and expiring contract detection",
      "milestone": "All 4 analytics tools operational; reconciliation compares alm_asset against cmdb_ci accurately",
      "status": "planned",
      "tickets": ["ASSET-016", "ASSET-017", "ASSET-018", "ASSET-019"]
    },
    {
      "id": "phase-5",
      "name": "Testing & Quality",
      "description": "Unit tests, integration tests, conftest fixtures, and minimum 80% code coverage across all modules",
      "milestone": "Test suite passes with >=80% coverage; all MCP tools have integration tests against real ServiceNow",
      "status": "planned",
      "tickets": ["ASSET-020", "ASSET-021", "ASSET-022", "ASSET-023"]
    },
    {
      "id": "phase-6",
      "name": "Documentation & Deployment",
      "description": "README, API docs, Docker containerization, CI/CD pipeline, and .env.example for configuration",
      "milestone": "Docker image builds and runs successfully; CI pipeline passes; README documents all tools",
      "status": "planned",
      "tickets": ["ASSET-024", "ASSET-025", "ASSET-026", "ASSET-027"]
    }
  ],
  "tickets": [
    {
      "id": "ASSET-001",
      "github_issue": 1,
      "title": "Initialize Python project structure with pyproject.toml and dependencies",
      "description": "Create the project directory layout following servicenow-cmdb-mcp reference architecture. Set up:\n- src/snow_asset_agent/ package with __init__.py\n- pyproject.toml with dependencies: fastmcp, pydantic>=2.0, requests, python-dotenv\n- Dev dependencies: pytest, pytest-cov, pytest-asyncio, ruff, mypy\n- .python-version (3.11+)\n- .gitignore (Python template + .env, .venv, __pycache__, .mypy_cache, .coverage)\n- .env.example with SERVICENOW_INSTANCE, SERVICENOW_USERNAME, SERVICENOW_PASSWORD placeholders\n\nAcceptance Criteria:\n- [ ] pyproject.toml installs cleanly with pip install -e .\n- [ ] Package structure matches: src/snow_asset_agent/{__init__.py, server.py, config.py, ...}\n- [ ] .gitignore excludes secrets and build artifacts\n- [ ] .env.example documents all required environment variables",
      "phase": "phase-1",
      "priority": "critical",
      "type": "feature",
      "status": "in-progress",
      "dependencies": [],
      "assigned_agent": "build",
      "estimated_complexity": "small",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-002",
      "github_issue": null,
      "title": "Implement configuration management with Pydantic settings",
      "description": "Create config.py with a Pydantic BaseSettings class that reads from environment variables and .env file.\n\nConfiguration fields:\n- SERVICENOW_INSTANCE (str, required) - e.g., 'dev12345.service-now.com'\n- SERVICENOW_USERNAME (str, required)\n- SERVICENOW_PASSWORD (str, required, SecretStr)\n- SERVICENOW_TIMEOUT (int, default=30)\n- SERVICENOW_PAGE_SIZE (int, default=100)\n- LOG_LEVEL (str, default='INFO')\n- CACHE_TTL_SECONDS (int, default=300)\n- MCP_SERVER_NAME (str, default='snow-asset-agent')\n- MCP_SERVER_VERSION (str, default='0.1.0')\n\nAcceptance Criteria:\n- [ ] Config loads from .env file via python-dotenv\n- [ ] Config validates required fields and raises clear errors\n- [ ] Passwords are never logged (SecretStr)\n- [ ] Config is importable as a singleton: from snow_asset_agent.config import settings",
      "phase": "phase-1",
      "priority": "critical",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-001"],
      "assigned_agent": "build",
      "estimated_complexity": "small",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-003",
      "github_issue": null,
      "title": "Implement ServiceNow REST client for asset tables",
      "description": "Create asset_client.py with an AssetClient class that handles all HTTP communication with ServiceNow REST API.\n\nCapabilities:\n- Base URL construction: https://{instance}/api/now/table/{table}\n- Basic auth using config credentials\n- GET with sysparm_query, sysparm_fields, sysparm_limit, sysparm_offset, sysparm_display_value\n- Pagination support (auto-fetch all pages or respect limit)\n- Response parsing: extract 'result' array from ServiceNow JSON envelope\n- Error handling: connection errors, 401/403/404/500 with clear messages\n- Request timeout from config\n- Logging of requests (URL, params, status code) without credentials\n\nTarget tables: alm_hardware, alm_consumable, alm_license, alm_asset, ast_contract, cmdb_ci, cmdb_software_instance\n\nAcceptance Criteria:\n- [ ] AssetClient.query(table, query, fields, limit) returns list of dicts\n- [ ] AssetClient.get_by_id(table, sys_id) returns single record dict\n- [ ] Pagination works for result sets > page_size\n- [ ] Auth failures raise descriptive exceptions\n- [ ] No credentials appear in logs",
      "phase": "phase-1",
      "priority": "critical",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-002"],
      "assigned_agent": "build",
      "estimated_complexity": "large",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-004",
      "github_issue": null,
      "title": "Define Pydantic models for ServiceNow asset records",
      "description": "Create models.py with Pydantic models representing ServiceNow asset records.\n\nModels to create:\n- HardwareAsset: sys_id, asset_tag, display_name, model, model_category, serial_number, assigned_to, location, install_status, substatus, cost, purchase_date, warranty_expiration, ci (linked CI sys_id)\n- SoftwareLicense: sys_id, asset_tag, display_name, product, license_key, entitlement_type, rights (count), allocated, license_metric, publisher, cost, start_date, end_date, compliance_status\n- ConsumableAsset: sys_id, asset_tag, display_name, model, quantity, quantity_remaining, cost, location\n- AssetContract: sys_id, contract_number, short_description, vendor, starts, ends, cost, payment_amount, renewal_date, state\n- AssetLifecycle: sys_id, asset_tag, stage, substatus, install_date, retired_date, disposal_date\n- AssetCostSummary: asset_tag, purchase_cost, annual_cost, depreciation_amount, current_value, total_cost_of_ownership\n- LicenseComplianceResult: product, entitlements, allocated, consumed, compliance_status, gap\n- AssetHealthMetrics: total_assets, active_assets, retired_assets, missing_assets, compliance_rate, avg_age_years, expiring_contracts_30d, underutilized_count\n- ReconciliationResult: matched, unmatched_assets, unmatched_cis, discrepancies\n\nAcceptance Criteria:\n- [ ] All models use Pydantic v2 BaseModel with proper field types\n- [ ] Optional fields default to None\n- [ ] Date fields use datetime or date types\n- [ ] Models are importable from snow_asset_agent.models",
      "phase": "phase-1",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-001"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-005",
      "github_issue": null,
      "title": "Implement custom exception hierarchy for asset operations",
      "description": "Create exceptions.py with a hierarchy of custom exceptions for clear error handling.\n\nExceptions:\n- AssetAgentError (base) - All snow-asset-agent errors inherit from this\n- ServiceNowConnectionError(AssetAgentError) - Cannot reach ServiceNow instance\n- ServiceNowAuthError(AssetAgentError) - 401/403 authentication/authorization failure\n- ServiceNowNotFoundError(AssetAgentError) - 404, record not found\n- ServiceNowAPIError(AssetAgentError) - Other API errors (500, rate limit, etc.)\n- AssetNotFoundError(AssetAgentError) - Specific asset not found by sys_id or asset_tag\n- LicenseComplianceError(AssetAgentError) - License compliance check failed\n- ReconciliationError(AssetAgentError) - Asset-to-CI reconciliation error\n- ConfigurationError(AssetAgentError) - Missing or invalid configuration\n\nEach exception should include:\n- Descriptive message\n- Optional status_code (for HTTP errors)\n- Optional table_name (for ServiceNow context)\n- Optional sys_id (for record context)\n\nAcceptance Criteria:\n- [ ] All exceptions inherit from AssetAgentError\n- [ ] Each includes relevant context attributes\n- [ ] Exceptions are importable from snow_asset_agent.exceptions",
      "phase": "phase-1",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-001"],
      "assigned_agent": "build",
      "estimated_complexity": "small",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-006",
      "github_issue": null,
      "title": "Create MCP server skeleton with health check tool and logging",
      "description": "Create server.py with the FastMCP server initialization and a health_check tool.\n\nImplementation:\n- Initialize FastMCP server with name and version from config\n- Configure structured logging (JSON format for production, readable for dev)\n- Register a `health_check` tool that:\n  1. Verifies ServiceNow connectivity by querying sys_properties (or any lightweight table)\n  2. Returns server version, ServiceNow instance, connection status, response time\n  3. Returns error details if connection fails (without credentials)\n- Add __main__.py entry point: python -m snow_asset_agent\n- Create logging_config.py with configurable log levels and formatters\n\nAcceptance Criteria:\n- [ ] `python -m snow_asset_agent` starts the MCP server\n- [ ] health_check tool is registered and callable via MCP protocol\n- [ ] health_check verifies real ServiceNow connectivity\n- [ ] Logging is structured with timestamps, levels, and module names\n- [ ] No credentials appear in any log output",
      "phase": "phase-1",
      "priority": "critical",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-002", "ASSET-003", "ASSET-005"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-007",
      "github_issue": null,
      "title": "Implement query_hardware_assets MCP tool",
      "description": "Register an MCP tool `query_hardware_assets` that searches and filters hardware assets from the alm_hardware table.\n\nParameters:\n- query (str, optional): Free-text search across display_name, asset_tag, serial_number\n- model_category (str, optional): Filter by model category (e.g., 'Computer', 'Server', 'Network Gear')\n- assigned_to (str, optional): Filter by assigned user\n- location (str, optional): Filter by location\n- install_status (str, optional): Filter by status (e.g., 'In use', 'Retired', 'In stock')\n- substatus (str, optional): Filter by substatus\n- limit (int, default=50): Max results to return\n\nBehavior:\n- Build sysparm_query from parameters using ServiceNow encoded query syntax\n- Query alm_hardware table via AssetClient\n- Return list of HardwareAsset model instances serialized to JSON\n- Include total count in response metadata\n\nAcceptance Criteria:\n- [ ] Tool registered with @mcp.tool() decorator\n- [ ] All filter parameters translate to correct sysparm_query\n- [ ] Returns real data from alm_hardware table\n- [ ] Empty results return empty list (not error)\n- [ ] Respects limit parameter",
      "phase": "phase-2",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-006", "ASSET-004"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-008",
      "github_issue": null,
      "title": "Implement query_software_licenses MCP tool",
      "description": "Register an MCP tool `query_software_licenses` that searches and filters software licenses from the alm_license table.\n\nParameters:\n- query (str, optional): Free-text search across display_name, product, publisher\n- product (str, optional): Filter by software product name\n- publisher (str, optional): Filter by publisher/vendor\n- entitlement_type (str, optional): Filter by license type (e.g., 'Per seat', 'Concurrent', 'Site')\n- compliance_status (str, optional): Filter by compliance status\n- expiring_within_days (int, optional): Find licenses expiring within N days\n- limit (int, default=50): Max results\n\nBehavior:\n- Build sysparm_query from parameters\n- For expiring_within_days: calculate future date and filter end_date <= that date AND end_date >= today\n- Query alm_license table via AssetClient\n- Return list of SoftwareLicense model instances\n\nAcceptance Criteria:\n- [ ] Tool registered with @mcp.tool() decorator\n- [ ] Date-based filtering works correctly for expiring licenses\n- [ ] Returns real data from alm_license table\n- [ ] Handles licenses with no end_date gracefully",
      "phase": "phase-2",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-006", "ASSET-004"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-009",
      "github_issue": null,
      "title": "Implement get_asset_details MCP tool",
      "description": "Register an MCP tool `get_asset_details` that retrieves full details for a single asset by sys_id or asset_tag.\n\nParameters:\n- sys_id (str, optional): ServiceNow sys_id of the asset\n- asset_tag (str, optional): Asset tag (e.g., 'P1000479')\n- include_ci (bool, default=True): Whether to also fetch linked CI record from cmdb_ci\n- include_contracts (bool, default=False): Whether to fetch associated contracts\n\nBehavior:\n- Must provide either sys_id or asset_tag (validate at least one)\n- Query alm_asset table (base table that includes hardware, software, consumable)\n- If include_ci and asset has ci field: fetch the linked cmdb_ci record\n- If include_contracts: query ast_contract where asset matches\n- Return combined result with asset details, optional CI info, optional contracts\n\nAcceptance Criteria:\n- [ ] Lookup by sys_id works\n- [ ] Lookup by asset_tag works\n- [ ] CI linkage is fetched when include_ci=True\n- [ ] Raises AssetNotFoundError for invalid sys_id/asset_tag\n- [ ] Returns real ServiceNow data",
      "phase": "phase-2",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-006", "ASSET-004"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-010",
      "github_issue": null,
      "title": "Implement get_asset_lifecycle MCP tool",
      "description": "Register an MCP tool `get_asset_lifecycle` that retrieves lifecycle stage information and transition history for an asset.\n\nParameters:\n- sys_id (str, optional): Asset sys_id\n- asset_tag (str, optional): Asset tag\n\nBehavior:\n- Fetch the asset from alm_asset to get current install_status and substatus\n- Map install_status values to lifecycle stages:\n  - 'On order' -> Procurement\n  - 'In stock' -> Received/Stocked\n  - 'In transit' -> In Transit\n  - 'Installed' / 'In use' -> Active/Deployed\n  - 'In maintenance' -> Maintenance\n  - 'Retired' -> Retired\n  - 'Missing' -> Missing\n  - 'Disposed' -> Disposed\n- Calculate time in current stage (from sys_updated_on or install_date)\n- Return AssetLifecycle model with current stage, substatus, dates, and time-in-stage\n\nAcceptance Criteria:\n- [ ] Maps all standard ServiceNow install_status values to lifecycle stages\n- [ ] Returns current stage, substatus, and relevant dates\n- [ ] Calculates time in current stage\n- [ ] Handles assets with missing date fields gracefully",
      "phase": "phase-2",
      "priority": "medium",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-006", "ASSET-004"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-011",
      "github_issue": null,
      "title": "Implement get_asset_contracts MCP tool",
      "description": "Register an MCP tool `get_asset_contracts` that retrieves contract information associated with assets.\n\nParameters:\n- asset_sys_id (str, optional): Get contracts for a specific asset\n- vendor (str, optional): Filter contracts by vendor\n- state (str, optional): Filter by contract state (e.g., 'Active', 'Expired', 'Draft')\n- expiring_within_days (int, optional): Find contracts expiring within N days\n- limit (int, default=50): Max results\n\nBehavior:\n- Query ast_contract table with filters\n- For asset-specific queries: filter where asset field matches\n- For expiring_within_days: compute date range and filter on ends field\n- Return list of AssetContract model instances\n- Include summary: total_contracts, active, expired, total_value\n\nAcceptance Criteria:\n- [ ] Asset-specific contract lookup works\n- [ ] Vendor and state filtering work\n- [ ] Expiring contract date math is correct\n- [ ] Returns real contract data from ast_contract\n- [ ] Summary includes aggregate statistics",
      "phase": "phase-2",
      "priority": "medium",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-006", "ASSET-004"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-012",
      "github_issue": null,
      "title": "Implement calculate_asset_costs MCP tool (TCO analysis)",
      "description": "Register an MCP tool `calculate_asset_costs` that computes total cost of ownership and cost analysis for assets.\n\nParameters:\n- sys_id (str, optional): Specific asset sys_id\n- asset_tag (str, optional): Specific asset tag\n- model_category (str, optional): Calculate average costs for a category\n- location (str, optional): Calculate costs for a location\n- include_contracts (bool, default=True): Include contract costs in TCO\n\nBehavior:\n- For single asset: fetch asset record, get purchase cost, calculate depreciation, add contract costs\n- For category/location: aggregate costs across matching assets\n- Depreciation calculation: straight-line over expected useful life (default 3yr for computers, 5yr for servers, configurable)\n- TCO = purchase_cost + SUM(contract_costs) + estimated_maintenance\n- Return AssetCostSummary model(s)\n\nAcceptance Criteria:\n- [ ] Single asset TCO calculation is accurate\n- [ ] Category/location aggregation works\n- [ ] Depreciation uses straight-line method\n- [ ] Contract costs are included when flag is True\n- [ ] Handles assets with missing cost fields (treats as 0)",
      "phase": "phase-3",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-009", "ASSET-011"],
      "assigned_agent": "build",
      "estimated_complexity": "large",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-013",
      "github_issue": null,
      "title": "Implement check_license_compliance MCP tool",
      "description": "Register an MCP tool `check_license_compliance` that checks software license compliance by comparing entitlements against usage.\n\nParameters:\n- product (str, optional): Check compliance for a specific product\n- publisher (str, optional): Check all products from a publisher\n- include_details (bool, default=True): Include per-product breakdown\n\nBehavior:\n- Fetch licenses from alm_license (entitlements/rights count)\n- Fetch installations from cmdb_software_instance (actual usage count)\n- For each product: compare rights vs allocated/installed count\n- Compliance status:\n  - 'Compliant': allocated <= rights\n  - 'Over-allocated': allocated > rights (compliance gap)\n  - 'Under-utilized': allocated < rights * 0.5 (waste)\n- Return list of LicenseComplianceResult models\n- Include overall summary: total_products, compliant_count, non_compliant_count, total_gap\n\nAcceptance Criteria:\n- [ ] Correctly compares license rights against software instances\n- [ ] Identifies over-allocated licenses\n- [ ] Identifies under-utilized licenses\n- [ ] Returns per-product breakdown when requested\n- [ ] Uses real data from alm_license and cmdb_software_instance tables",
      "phase": "phase-3",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-008"],
      "assigned_agent": "build",
      "estimated_complexity": "large",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-014",
      "github_issue": null,
      "title": "Implement get_license_utilization MCP tool",
      "description": "Register an MCP tool `get_license_utilization` that shows license usage versus entitlements with utilization percentages.\n\nParameters:\n- product (str, optional): Specific product name\n- publisher (str, optional): Filter by publisher\n- min_utilization_pct (float, optional): Only show licenses with utilization >= this %\n- max_utilization_pct (float, optional): Only show licenses with utilization <= this %\n- limit (int, default=50): Max results\n\nBehavior:\n- Fetch licenses from alm_license\n- For each license: calculate utilization = (allocated / rights) * 100\n- Apply utilization percentage filters\n- Sort by utilization descending (most utilized first)\n- Return license details with utilization metrics\n\nAcceptance Criteria:\n- [ ] Utilization percentage is calculated correctly\n- [ ] Min/max utilization filters work\n- [ ] Handles licenses with 0 rights (division by zero)\n- [ ] Returns real utilization data\n- [ ] Sorted by utilization descending",
      "phase": "phase-3",
      "priority": "medium",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-008"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-015",
      "github_issue": null,
      "title": "Implement track_asset_depreciation MCP tool",
      "description": "Register an MCP tool `track_asset_depreciation` that calculates and tracks depreciation schedules for hardware assets.\n\nParameters:\n- sys_id (str, optional): Specific asset sys_id\n- asset_tag (str, optional): Specific asset tag\n- model_category (str, optional): Calculate for all assets in a category\n- method (str, default='straight_line'): Depreciation method (straight_line only for v1)\n- useful_life_years (int, optional): Override default useful life\n\nBehavior:\n- Fetch asset(s) with purchase_date and cost fields\n- Default useful life by category: Computer=3yr, Server=5yr, Network Gear=5yr, Other=4yr\n- Straight-line: annual_depreciation = cost / useful_life_years\n- Calculate: current_value = max(0, cost - (annual_depreciation * years_since_purchase))\n- Calculate: accumulated_depreciation = cost - current_value\n- Calculate: remaining_useful_life = max(0, useful_life_years - years_since_purchase)\n- Return depreciation schedule with yearly breakdown\n\nAcceptance Criteria:\n- [ ] Straight-line depreciation calculation is correct\n- [ ] Category-based useful life defaults work\n- [ ] Custom useful_life_years override works\n- [ ] Handles assets with no purchase_date (skip with warning)\n- [ ] Current value never goes below 0",
      "phase": "phase-3",
      "priority": "medium",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-009"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-016",
      "github_issue": null,
      "title": "Implement find_underutilized_assets MCP tool",
      "description": "Register an MCP tool `find_underutilized_assets` that identifies assets with low utilization or that appear unused.\n\nParameters:\n- days_inactive (int, default=90): Consider unused if not updated/accessed in N days\n- model_category (str, optional): Filter by category\n- location (str, optional): Filter by location\n- include_retired (bool, default=False): Include retired assets\n- limit (int, default=50): Max results\n\nBehavior:\n- Query alm_hardware for assets where:\n  - install_status is 'In use' or 'Installed'\n  - sys_updated_on < (now - days_inactive) as a proxy for inactivity\n  - OR assigned_to is empty (unassigned but 'in use')\n- Also check for assets with no linked CI (orphaned assets)\n- Categorize: 'unassigned', 'inactive', 'orphaned_no_ci'\n- Return list with asset details and underutilization reason\n- Include summary: total_underutilized, by_reason counts, estimated_waste_cost\n\nAcceptance Criteria:\n- [ ] Identifies assets not updated in N days\n- [ ] Identifies unassigned 'in use' assets\n- [ ] Identifies assets with no CI linkage\n- [ ] Estimated waste cost is calculated from asset purchase prices\n- [ ] Returns real data from ServiceNow",
      "phase": "phase-4",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-007"],
      "assigned_agent": "build",
      "estimated_complexity": "large",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-017",
      "github_issue": null,
      "title": "Implement reconcile_assets_to_cis MCP tool",
      "description": "Register an MCP tool `reconcile_assets_to_cis` that compares assets in alm_asset against configuration items in cmdb_ci to find discrepancies.\n\nParameters:\n- model_category (str, optional): Reconcile only a specific category\n- location (str, optional): Reconcile only a specific location\n- include_details (bool, default=True): Include per-record discrepancy details\n\nBehavior:\n- Fetch all active assets from alm_asset (or filtered subset)\n- Fetch all active CIs from cmdb_ci (or filtered subset)\n- Match assets to CIs using the ci field on alm_asset and asset field on cmdb_ci\n- Identify:\n  - matched: asset has a CI and CI has the asset (bidirectional)\n  - unmatched_assets: assets with no linked CI\n  - unmatched_cis: CIs with no linked asset\n  - discrepancies: linked but with mismatched data (e.g., different serial numbers, locations)\n- Return ReconciliationResult model\n\nAcceptance Criteria:\n- [ ] Bidirectional matching works (asset->CI and CI->asset)\n- [ ] Identifies orphaned assets (no CI)\n- [ ] Identifies orphaned CIs (no asset)\n- [ ] Detects data discrepancies between matched pairs\n- [ ] Category and location filters work\n- [ ] Uses real data from both alm_asset and cmdb_ci",
      "phase": "phase-4",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-007", "ASSET-009"],
      "assigned_agent": "build",
      "estimated_complexity": "xl",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-018",
      "github_issue": null,
      "title": "Implement get_asset_health_metrics MCP tool",
      "description": "Register an MCP tool `get_asset_health_metrics` that provides an overall asset health dashboard with key metrics.\n\nParameters:\n- None required (dashboard is aggregate)\n- location (str, optional): Scope to a specific location\n- model_category (str, optional): Scope to a specific category\n\nBehavior:\n- Query alm_asset with aggregate stats (use sysparm_query with groupby or multiple targeted queries)\n- Compute metrics:\n  - total_assets: count of all assets\n  - active_assets: count where install_status in ('In use', 'Installed')\n  - retired_assets: count where install_status == 'Retired'\n  - missing_assets: count where install_status == 'Missing'\n  - in_stock_assets: count where install_status == 'In stock'\n  - compliance_rate: from license compliance check (call check_license_compliance internally)\n  - avg_age_years: average age of active assets based on purchase_date\n  - expiring_contracts_30d: count of contracts expiring in 30 days\n  - underutilized_count: count of underutilized assets\n  - total_asset_value: sum of costs of active assets\n  - monthly_contract_cost: sum of active contract monthly payments\n- Return AssetHealthMetrics model\n\nAcceptance Criteria:\n- [ ] All metrics computed from real ServiceNow data\n- [ ] Location and category scoping works\n- [ ] Handles empty tables gracefully (returns 0s, not errors)\n- [ ] Average age calculation handles missing purchase_dates\n- [ ] Returns comprehensive health dashboard",
      "phase": "phase-4",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-013", "ASSET-016", "ASSET-011"],
      "assigned_agent": "build",
      "estimated_complexity": "large",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-019",
      "github_issue": null,
      "title": "Implement find_expiring_contracts MCP tool",
      "description": "Register an MCP tool `find_expiring_contracts` that finds asset contracts nearing their expiration or renewal dates.\n\nParameters:\n- days_ahead (int, default=90): Find contracts expiring within N days\n- vendor (str, optional): Filter by vendor\n- min_value (float, optional): Only contracts with value >= this amount\n- include_expired (bool, default=False): Also show recently expired contracts (last 30 days)\n- limit (int, default=50): Max results\n\nBehavior:\n- Query ast_contract where ends BETWEEN today AND (today + days_ahead)\n- If include_expired: also fetch where ends BETWEEN (today - 30) AND today\n- Sort by expiration date ascending (soonest first)\n- Calculate days_until_expiry for each contract\n- Categorize urgency: critical (<30d), warning (30-60d), notice (60-90d), info (>90d)\n- Return contracts with urgency level and days remaining\n- Include summary: total_expiring, total_value_at_risk, by_urgency counts\n\nAcceptance Criteria:\n- [ ] Date range filtering is correct\n- [ ] Urgency categorization works\n- [ ] Days remaining calculation is accurate\n- [ ] Vendor and value filters work\n- [ ] Recently expired inclusion works when flag is True\n- [ ] Real contract data from ast_contract",
      "phase": "phase-4",
      "priority": "medium",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-011"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-020",
      "github_issue": null,
      "title": "Create test infrastructure: conftest.py, fixtures, and test utilities",
      "description": "Set up the testing infrastructure for the project.\n\nImplementation:\n- tests/ directory with __init__.py\n- conftest.py with shared fixtures:\n  - Real ServiceNow client fixture (uses .env credentials)\n  - Settings fixture with test configuration\n  - Sample asset data fixture (fetches a known asset from the real instance)\n  - Sample license data fixture\n  - Sample contract data fixture\n- tests/utils.py with test helpers:\n  - skip_if_no_servicenow decorator (skip tests if ServiceNow is unreachable)\n  - assert_valid_asset, assert_valid_license, assert_valid_contract helper assertions\n- pytest.ini or pyproject.toml [tool.pytest.ini_options] configuration:\n  - markers: integration, slow\n  - default: run all tests\n  - coverage config: minimum 80%\n\nAcceptance Criteria:\n- [ ] conftest.py provides reusable fixtures\n- [ ] Fixtures connect to real ServiceNow (ZERO MOCKS)\n- [ ] skip_if_no_servicenow gracefully skips when credentials missing\n- [ ] pytest runs and discovers test files",
      "phase": "phase-5",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-006"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-021",
      "github_issue": null,
      "title": "Write unit tests for config, models, exceptions, and client modules",
      "description": "Create comprehensive unit tests for the foundation modules.\n\nTest files:\n- tests/test_config.py: Test configuration loading, validation, defaults, missing required fields\n- tests/test_models.py: Test all Pydantic model creation, serialization, optional fields, validation\n- tests/test_exceptions.py: Test exception hierarchy, attributes, string representations\n- tests/test_asset_client.py: Test client initialization, URL construction, query building, error handling, pagination\n\nAll tests must use REAL ServiceNow connections where applicable (no mocking).\nFor pure unit tests (models, exceptions): test logic directly.\nFor client tests: connect to real ServiceNow and verify responses.\n\nAcceptance Criteria:\n- [ ] Each module has a corresponding test file\n- [ ] Config tests verify both valid and invalid configurations\n- [ ] Model tests verify serialization/deserialization\n- [ ] Client tests verify real API communication\n- [ ] All tests pass with pytest\n- [ ] Combined coverage for these modules >= 85%",
      "phase": "phase-5",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-020", "ASSET-003", "ASSET-004", "ASSET-005"],
      "assigned_agent": "build",
      "estimated_complexity": "large",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-022",
      "github_issue": null,
      "title": "Write integration tests for all MCP tools",
      "description": "Create integration tests that exercise each MCP tool end-to-end against a real ServiceNow instance.\n\nTest files:\n- tests/test_tools_core.py: Tests for query_hardware_assets, query_software_licenses, get_asset_details, get_asset_lifecycle, get_asset_contracts\n- tests/test_tools_financial.py: Tests for calculate_asset_costs, check_license_compliance, get_license_utilization, track_asset_depreciation\n- tests/test_tools_analytics.py: Tests for find_underutilized_assets, reconcile_assets_to_cis, get_asset_health_metrics, find_expiring_contracts\n\nEach tool test should:\n1. Call the tool with valid parameters and verify response structure\n2. Call with filter parameters and verify filtering works\n3. Call with invalid parameters and verify appropriate error handling\n4. Verify returned data matches Pydantic model schemas\n\nAcceptance Criteria:\n- [ ] Every MCP tool has at least 3 test cases\n- [ ] Tests use real ServiceNow data (ZERO MOCKS)\n- [ ] Tests are marked with @pytest.mark.integration\n- [ ] Error handling paths are tested\n- [ ] All tests pass",
      "phase": "phase-5",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-020", "ASSET-019"],
      "assigned_agent": "build",
      "estimated_complexity": "xl",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-023",
      "github_issue": null,
      "title": "Achieve >=80% code coverage and fix coverage gaps",
      "description": "Run full test suite with coverage reporting and close any coverage gaps.\n\nImplementation:\n- Run pytest --cov=snow_asset_agent --cov-report=term-missing --cov-report=html\n- Identify modules below 80% coverage\n- Add targeted tests for uncovered code paths:\n  - Error handling branches\n  - Edge cases (empty results, missing fields, null values)\n  - Boundary conditions (pagination limits, date boundaries)\n- Add .coveragerc or pyproject.toml coverage configuration\n- Ensure no module is below 70% individually and project-wide is >=80%\n\nAcceptance Criteria:\n- [ ] Overall coverage >= 80%\n- [ ] No individual module below 70%\n- [ ] Coverage report is generated (HTML and terminal)\n- [ ] All edge cases and error paths are covered\n- [ ] pytest runs cleanly with 0 failures",
      "phase": "phase-5",
      "priority": "medium",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-021", "ASSET-022"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-024",
      "github_issue": null,
      "title": "Write comprehensive README with tool documentation",
      "description": "Create a production-quality README.md for the project.\n\nSections:\n- Project overview and purpose\n- Architecture diagram (text-based)\n- Prerequisites (Python 3.11+, ServiceNow instance, ServiceNow user with asset_read role)\n- Installation instructions (pip install, from source)\n- Configuration (.env setup, all environment variables documented)\n- Quick start guide\n- MCP Tool Reference: table documenting all 13+ tools with:\n  - Tool name\n  - Description\n  - Parameters with types and defaults\n  - Example usage\n  - Example response\n- ServiceNow Tables Reference: which tables are queried and required roles\n- Dependency on servicenow-cmdb-mcp (for CI data in reconciliation)\n- Development guide (running tests, linting, contributing)\n- License\n\nAcceptance Criteria:\n- [ ] README covers all sections listed above\n- [ ] Every MCP tool is documented with parameters and examples\n- [ ] Installation and configuration are clear enough for a new user\n- [ ] ServiceNow prerequisites and roles are documented\n- [ ] No placeholder or TODO text",
      "phase": "phase-6",
      "priority": "high",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-019"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-025",
      "github_issue": null,
      "title": "Create Dockerfile and docker-compose for containerized deployment",
      "description": "Create Docker configuration for running the MCP server in a container.\n\nFiles:\n- Dockerfile:\n  - Multi-stage build (builder + runtime)\n  - Python 3.11-slim base\n  - Install dependencies from pyproject.toml\n  - Copy source code\n  - Non-root user for security\n  - Health check: attempt MCP connection or simple Python import check\n  - Entrypoint: python -m snow_asset_agent\n- docker-compose.yml:\n  - snow-asset-agent service\n  - Environment variables from .env file\n  - Port mapping (if applicable for MCP stdio vs SSE)\n  - Volume mount for logs\n  - Restart policy\n- .dockerignore: exclude .git, .venv, __pycache__, .env, tests, docs\n\nAcceptance Criteria:\n- [ ] docker build completes successfully\n- [ ] docker run starts the MCP server\n- [ ] Environment variables are passed correctly\n- [ ] Image size is reasonable (<200MB)\n- [ ] Non-root user is used\n- [ ] .dockerignore excludes sensitive files",
      "phase": "phase-6",
      "priority": "medium",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-006"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-026",
      "github_issue": null,
      "title": "Create GitHub Actions CI/CD pipeline",
      "description": "Create a GitHub Actions workflow for continuous integration.\n\nFile: .github/workflows/ci.yml\n\nWorkflow triggers: push to main, pull requests to main\n\nJobs:\n1. lint:\n   - Run ruff check src/ tests/\n   - Run ruff format --check src/ tests/\n   - Run mypy src/snow_asset_agent/\n2. test:\n   - Python 3.11 and 3.12 matrix\n   - Install dependencies\n   - Run pytest with coverage (unit tests only, skip integration in CI)\n   - Upload coverage report\n   - Fail if coverage < 80%\n3. build:\n   - Build Docker image\n   - Verify image starts successfully\n\nSecrets needed: SERVICENOW_INSTANCE, SERVICENOW_USERNAME, SERVICENOW_PASSWORD (for integration tests, optional)\n\nAcceptance Criteria:\n- [ ] Workflow runs on push and PR\n- [ ] Lint job catches style and type issues\n- [ ] Test job runs with coverage enforcement\n- [ ] Docker build job verifies containerization\n- [ ] Integration tests are skipped in CI (marked as optional)",
      "phase": "phase-6",
      "priority": "medium",
      "type": "feature",
      "status": "planned",
      "dependencies": ["ASSET-023", "ASSET-025"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    },
    {
      "id": "ASSET-027",
      "github_issue": null,
      "title": "Add type stubs, py.typed marker, and complete type annotations",
      "description": "Ensure the entire codebase has complete type annotations and passes mypy strict mode.\n\nImplementation:\n- Add py.typed marker file to src/snow_asset_agent/\n- Review all modules and add/fix type annotations:\n  - Function parameters and return types\n  - Variable annotations where needed\n  - Generic types for collections (list[HardwareAsset], dict[str, Any])\n- Configure mypy in pyproject.toml:\n  - strict = true\n  - warn_return_any = true\n  - warn_unused_configs = true\n  - disallow_untyped_defs = true\n- Fix all mypy errors\n- Add ruff configuration in pyproject.toml for consistent formatting\n\nAcceptance Criteria:\n- [ ] mypy --strict passes with 0 errors\n- [ ] py.typed marker exists\n- [ ] All public functions have type annotations\n- [ ] ruff check passes with 0 errors\n- [ ] ruff format reports no changes needed",
      "phase": "phase-6",
      "priority": "low",
      "type": "tech-debt",
      "status": "planned",
      "dependencies": ["ASSET-019"],
      "assigned_agent": "build",
      "estimated_complexity": "medium",
      "pr_number": null,
      "completed_at": null
    }
  ]
}
